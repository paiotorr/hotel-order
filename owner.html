<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Owner Dashboard</title>

<style>
body{
  margin:0;
  padding:20px;
  font-family: Arial, sans-serif;
  background:#ffffff;
}

h1{margin-bottom:20px;}

.clearAll{
  margin-bottom:20px;
  padding:14px 22px;
  font-size:18px;
  background:#000;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.layout{
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:20px;
}

/* Boxes */
.pending{border:2px solid #f1c40f;}
.accepted{border:2px solid #2ecc71;}
.rejected{border:2px solid #e74c3c;}

.pending,.accepted,.rejected{
  border-radius:12px;
  padding:20px;
}

.pending h2{color:#f39c12;}
.accepted h2{color:#27ae60;}
.rejected h2{color:#c0392b;}

.right{
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* ORDER CARD */
.order{
  border:2px solid #ccc;
  border-radius:12px;
  padding:18px;
  margin-bottom:18px;
}

.orderHeader{
  margin-bottom:12px;
}

/* TABLE */
.table{
  font-size:24px;
  font-weight:900;
}

/* CUSTOMER */
.customer{
  font-size:22px;
  font-weight:900;
  color:#000;
  margin-top:4px;
}

/* ðŸ”¥ TIME & DATE â€” FIXED */
.time{
  font-size:20px;        /* bigger */
  font-weight:800;       /* bold */
  color:#000;            /* black */
  margin-top:6px;
}

/* TOTAL */
.total{
  font-size:24px;
  font-weight:900;
  margin:14px 0;
  color:#000;
}

/* ITEM */
.item{
  display:flex;
  align-items:center;
  margin-bottom:16px;
}

.item img{
  width:150px;
  height:150px;
  object-fit:cover;
  border-radius:16px;
  margin-right:18px;
  border:2px solid #ccc;
}

.itemName{
  font-size:28px;
  font-weight:900;
}

/* Buttons */
.actions button{
  padding:14px 18px;
  font-size:17px;
  margin-right:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.accept{background:#2ecc71;color:#fff;}
.reject{background:#e74c3c;color:#fff;}
.clear{background:#555;color:#fff;}

.statusIcon{
  font-size:48px;
  margin-top:10px;
}

.tick{color:#2ecc71;}
.cross{color:#e74c3c;}
</style>
</head>

<body>

<h1>ðŸ“‹ Paiotorr</h1>
<button class="clearAll" onclick="clearAllOrders()">Clear ALL Accepted & Rejected</button>

<div class="layout">

  <!-- LEFT -->
  <div class="pending">
    <h2>ðŸŸ¡ Pending Orders</h2>
    <div id="pending"></div>
  </div>

  <!-- RIGHT -->
  <div class="right">
    <div class="accepted">
      <h2>ðŸŸ¢ Accepted</h2>
      <div id="accepted"></div>
    </div>

    <div class="rejected">
      <h2>ðŸ”´ Rejected</h2>
      <div id="rejected"></div>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, onSnapshot,
  doc, updateDoc, deleteDoc,
  getDocs, query, orderBy
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* SOUND */
function playBeep(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type="square";
  osc.frequency.value=1000;
  gain.gain.value=0.35;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.25);
}

/* IMAGE MAP */
const IMAGE_MAP = {
  "Pizza": "https://raw.githubusercontent.com/paiotorr/Paiotorr/main/image/Pizza.jpg",
  "Burger": "https://images.unsplash.com/photo-1550547660-d9450f859349"
};
const PLACEHOLDER = "https://via.placeholder.com/150?text=Item";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyDSf51jWs3I4AXX0U8M_HxKn4VtRYg72xs",
  authDomain:"hotel-order-7f1f2.firebaseapp.com",
  projectId:"hotel-order-7f1f2"
});
const db = getFirestore(app);

const pendingDiv  = document.getElementById("pending");
const acceptedDiv = document.getElementById("accepted");
const rejectedDiv = document.getElementById("rejected");

const known = new Set();
const q = query(collection(db,"orders"), orderBy("time","desc"));

onSnapshot(q, snap=>{
  pendingDiv.innerHTML="";
  acceptedDiv.innerHTML="";
  rejectedDiv.innerHTML="";

  snap.forEach(d=>{
    const o = d.data();

    if(!known.has(d.id) && o.status==="pending"){
      playBeep();
      known.add(d.id);
    }

    const totalPrice = typeof o.total === "number" ? o.total : 0;
    const customerName = o.customer || "â€”";

    let itemsHTML="";
    o.items.forEach(i=>{
      const img = IMAGE_MAP[i.name] || PLACEHOLDER;
      itemsHTML+=`
        <div class="item">
          <img src="${img}">
          <div class="itemName">${i.name} Ã— ${i.qty}</div>
        </div>`;
    });

    const card = `
      <div class="order">
        <div class="orderHeader">
          <div class="table">Table ${o.table}</div>
          <div class="customer">ðŸ‘¤ ${customerName}</div>
          <div class="time">ðŸ“… ${o.time}</div>
        </div>
        <div class="total">ðŸ’° Total: â‚¹${totalPrice}</div>
        ${itemsHTML}
      </div>`;

    if(o.status==="pending"){
      pendingDiv.innerHTML+=card.replace(
        "</div>",
        `<div class="actions">
          <button class="accept" onclick="setStatus('${d.id}','accepted')">Accept</button>
          <button class="reject" onclick="setStatus('${d.id}','rejected')">Reject</button>
          <button class="clear" onclick="clearOne('${d.id}')">Clear</button>
        </div></div>`
      );
    }

    if(o.status==="accepted"){
      acceptedDiv.innerHTML+=card+`<div class="statusIcon tick">âœ”</div>`;
    }

    if(o.status==="rejected"){
      rejectedDiv.innerHTML+=card+`<div class="statusIcon cross">âœ–</div>`;
    }
  });
});

/* ACTIONS */
window.setStatus = async(id,status)=>{
  await updateDoc(doc(db,"orders",id),{status});
};

window.clearOne = async(id)=>{
  if(confirm("Clear this pending order?")){
    await deleteDoc(doc(db,"orders",id));
  }
};

window.clearAllOrders = async()=>{
  if(!confirm("Clear ALL accepted & rejected orders?")) return;
  const snap = await getDocs(collection(db,"orders"));
  snap.forEach(d=>{
    const o=d.data();
    if(o.status==="accepted"||o.status==="rejected"){
      deleteDoc(doc(db,"orders",d.id));
    }
  });
};
</script>

</body>
</html>