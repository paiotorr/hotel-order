<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Paiotorr â€“ Owner Dashboard</title>

<style>
html,body{
  margin:0;
  padding:0;
  font-family:Arial, sans-serif;
  background:#ffffff;
}
body{ padding:20px; }

h1{ margin-bottom:14px; }

.main{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:16px;
}

/* existing styles unchanged */
.pending{
  border:2px solid #f1c40f;
  border-radius:12px;
  padding:14px;
  height:55vh;
  overflow-y:auto;
}

.right{
  display:grid;
  grid-template-rows:1fr 1fr;
  gap:16px;
  height:55vh;
}

.accepted,.rejected{
  border-radius:12px;
  padding:14px;
  overflow-y:auto;
}

.accepted{ border:2px solid #2ecc71; }
.rejected{ border:2px solid #e74c3c; }

h2{
  margin:0 0 8px;
  position:sticky;
  top:0;
  background:#fff;
}

.order{
  border:2px solid #ccc;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}

.item{
  display:flex;
  align-items:center;
  gap:10px;
}

.item img{
  width:60px;
  height:60px;
  border-radius:8px;
  object-fit:cover;
  border:1px solid #ccc;
}

/* FILTER BOX */
.filterBox{
  margin-top:22px;
  padding-top:16px;
  border-top:3px solid #000;
}

.filter{
  display:flex;
  gap:14px;
}

.filter input{
  padding:10px;
  font-size:16px;
}

.filter button{
  padding:10px 18px;
  font-weight:bold;
  border:2px solid #000;
  background:#000;
  color:#fff;
  cursor:pointer;
}

.reverse{
  background:#fff !important;
  color:#000 !important;
}

/* COMPARISON VIEW */
.compareBox{
  margin-top:20px;
  display:grid;
  grid-template-columns:1fr 4px 1fr;
}

.midLine{
  background:#000;
}

.compareCol{
  padding:10px;
}

.compareItem{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:14px;
}

.compareItem img{
  width:55px;
  height:55px;
  border-radius:8px;
}

.stats{
  font-size:14px;
}
</style>
</head>

<body>

<h1>ðŸ“‹ Paiotorr â€“ Owner</h1>

<div class="main">
  <div class="pending">
    <h2>ðŸŸ¡ Pending Orders</h2>
    <div id="pending"></div>
  </div>

  <div class="right">
    <div class="accepted">
      <h2>ðŸŸ¢ Accepted</h2>
      <div id="accepted"></div>
    </div>

    <div class="rejected">
      <h2>ðŸ”´ Rejected</h2>
      <div id="rejected"></div>
    </div>
  </div>
</div>

<!-- DATE FILTER -->
<div class="filterBox">
  <h2>ðŸ“… Filter Accepted & Rejected Orders by Date</h2>
  <div class="filter">
    <input type="date" id="fromDate">
    <input type="date" id="toDate">
    <button id="applyBtn">Apply</button>
    <button id="clearBtn">Clear</button>
  </div>
</div>

<!-- COMPARISON RESULT -->
<div id="compareResult"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyDSf51jWs3I4AXX0U8M_HxKn4VtRYg72xs",
  authDomain:"hotel-order-7f1f2.firebaseapp.com",
  projectId:"hotel-order-7f1f2"
});
const db = getFirestore(app);

const fromDate = document.getElementById("fromDate");
const toDate = document.getElementById("toDate");
const applyBtn = document.getElementById("applyBtn");
const clearBtn = document.getElementById("clearBtn");
const compareResult = document.getElementById("compareResult");

const DEFAULT_IMG="https://raw.githubusercontent.com/paiotorr/Paiotorr/main/image/Pizza.jpg";

let allOrders=[];

onSnapshot(collection(db,"orders"),snap=>{
  allOrders=[];
  snap.forEach(d=>allOrders.push(d.data()));
});

applyBtn.onclick=()=>{
  if(!fromDate.value||!toDate.value)return;

  const f=new Date(fromDate.value);
  const t=new Date(toDate.value); t.setHours(23,59,59);

  const map={};

  allOrders.forEach(o=>{
    if(o.status==="accepted"||o.status==="rejected"){
      const d=new Date(o.time);
      if(d>=f && d<=t){
        o.items.forEach(i=>{
          if(!map[i.name]){
            map[i.name]={img:i.img||DEFAULT_IMG,acc:0,rej:0};
          }
          if(o.status==="accepted") map[i.name].acc+=i.qty;
          else map[i.name].rej+=i.qty;
        });
      }
    }
  });

  let accHTML="",rejHTML="";

  Object.keys(map).forEach(k=>{
    const a=map[k].acc;
    const r=map[k].rej;
    const total=a+r||1;

    accHTML+=`
      <div class="compareItem">
        <img src="${map[k].img}">
        <div class="stats">
          <b>${k}</b><br>
          Qty: ${a}<br>
          ${Math.round(a/total*100)}%
        </div>
      </div>`;

    rejHTML+=`
      <div class="compareItem">
        <img src="${map[k].img}">
        <div class="stats">
          <b>${k}</b><br>
          Qty: ${r}<br>
          ${Math.round(r/total*100)}%
        </div>
      </div>`;
  });

  compareResult.innerHTML=`
    <div class="compareBox">
      <div class="compareCol">${accHTML}</div>
      <div class="midLine"></div>
      <div class="compareCol">${rejHTML}</div>
    </div>`;
};

clearBtn.onclick=()=>{
  fromDate.value="";
  toDate.value="";
  compareResult.innerHTML="";
};
</script>

</body>
</html>