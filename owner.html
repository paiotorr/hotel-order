<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Owner Dashboard</title>

<style>
body{
  margin:0;
  padding:20px;
  font-family: Arial, sans-serif;
  background:#ffffff;
}

h1{margin-bottom:20px;}

.clearAll{
  margin-bottom:20px;
  padding:14px 22px;
  font-size:18px;
  background:#000;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.layout{
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:20px;
}

/* Boxes */
.pending{border:2px solid #f1c40f;}
.accepted{border:2px solid #2ecc71;}
.rejected{border:2px solid #e74c3c;}

.pending,.accepted,.rejected{
  border-radius:12px;
  padding:20px;
}

.pending h2{color:#f39c12;}
.accepted h2{color:#27ae60;}
.rejected h2{color:#c0392b;}

.right{
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* Order Card */
.order{
  border:2px solid #ccc;
  border-radius:12px;
  padding:18px;
  margin-bottom:18px;
}

.orderHeader{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
}

.table{
  font-size:22px;
  font-weight:bold;
}

.time{
  font-size:15px;
  color:#555;
}

.item{
  display:flex;
  align-items:center;
  margin-bottom:12px;
}

.item img{
  width:80px;
  height:80px;
  object-fit:cover;
  border-radius:10px;
  margin-right:14px;
}

.itemName{
  font-size:20px;
  font-weight:bold;
}

/* Buttons */
.actions button{
  padding:14px 18px;
  font-size:17px;
  margin-right:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.accept{background:#2ecc71;color:#fff;}
.reject{background:#e74c3c;color:#fff;}
.clear{background:#555;color:#fff;}

.statusIcon{
  font-size:42px;
  margin-top:10px;
}

.tick{color:#2ecc71;}
.cross{color:#e74c3c;}
</style>
</head>

<body>

<h1>ðŸ“‹ Paiotorr</h1>
<button class="clearAll" onclick="clearAllOrders()">Clear ALL Accepted & Rejected</button>

<div class="layout">

  <!-- LEFT -->
  <div class="pending">
    <h2>ðŸŸ¡ Pending Orders</h2>
    <div id="pending"></div>
  </div>

  <!-- RIGHT -->
  <div class="right">
    <div class="accepted">
      <h2>ðŸŸ¢ Accepted</h2>
      <div id="accepted"></div>
    </div>

    <div class="rejected">
      <h2>ðŸ”´ Rejected</h2>
      <div id="rejected"></div>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc,
  deleteDoc,
  getDocs,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDSf51jWs3I4AXX0U8M_HxKn4VtRYg72xs",
  authDomain: "hotel-order-7f1f2.firebaseapp.com",
  projectId: "hotel-order-7f1f2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const pendingDiv  = document.getElementById("pending");
const acceptedDiv = document.getElementById("accepted");
const rejectedDiv = document.getElementById("rejected");

/* Newest first */
const q = query(collection(db,"orders"), orderBy("time","desc"));

onSnapshot(q, snap => {
  pendingDiv.innerHTML="";
  acceptedDiv.innerHTML="";
  rejectedDiv.innerHTML="";

  snap.forEach(d=>{
    const o = d.data();

    /* ðŸ”¥ MERGE SAME ITEMS */
    const merged = {};
    o.items.forEach(i=>{
      if(merged[i.name]){
        merged[i.name].qty += i.qty;
      }else{
        merged[i.name] = {
          name: i.name,
          img: i.img,
          qty: i.qty
        };
      }
    });

    let itemsHTML = "";
    Object.values(merged).forEach(i=>{
      itemsHTML += `
        <div class="item">
          <img src="${i.img}">
          <div class="itemName">${i.name} Ã— ${i.qty}</div>
        </div>`;
    });

    /* PENDING */
    if(o.status==="pending"){
      pendingDiv.innerHTML += `
        <div class="order">
          <div class="orderHeader">
            <div class="table">Table ${o.table}</div>
            <div class="time">ðŸ•’ ${o.time}</div>
          </div>
          ${itemsHTML}
          <div class="actions">
            <button class="accept" onclick="setStatus('${d.id}','accepted')">Accept</button>
            <button class="reject" onclick="setStatus('${d.id}','rejected')">Reject</button>
            <button class="clear" onclick="clearOne('${d.id}')">Clear</button>
          </div>
        </div>`;
    }

    /* ACCEPTED */
    if(o.status==="accepted"){
      acceptedDiv.innerHTML += `
        <div class="order">
          <div class="orderHeader">
            <div class="table">Table ${o.table}</div>
            <div class="time">ðŸ•’ ${o.time}</div>
          </div>
          ${itemsHTML}
          <div class="statusIcon tick">âœ”</div>
        </div>`;
    }

    /* REJECTED */
    if(o.status==="rejected"){
      rejectedDiv.innerHTML += `
        <div class="order">
          <div class="orderHeader">
            <div class="table">Table ${o.table}</div>
            <div class="time">ðŸ•’ ${o.time}</div>
          </div>
          ${itemsHTML}
          <div class="statusIcon cross">âœ–</div>
        </div>`;
    }
  });
});

/* Actions */
window.setStatus = async (id, status) => {
  await updateDoc(doc(db,"orders",id), { status });
};

window.clearOne = async (id) => {
  if(confirm("Clear this pending order?")){
    await deleteDoc(doc(db,"orders",id));
  }
};

window.clearAllOrders = async () => {
  if(!confirm("Clear ALL accepted & rejected orders?")) return;
  const snap = await getDocs(collection(db,"orders"));
  snap.forEach(d=>{
    const o=d.data();
    if(o.status==="accepted" || o.status==="rejected"){
      deleteDoc(doc(db,"orders",d.id));
    }
  });
};
</script>

</body>
</html>